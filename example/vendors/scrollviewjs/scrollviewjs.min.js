!function(t,i){"function"==typeof define&&define.amd?define(function(){return t.ScrollViewJS=i()}):"object"==typeof module&&module.exports?module.exports=t.ScrollViewJS=i():t.ScrollViewJS=i()}(this,function(){"use strict";function t(t){function i(t){return t.charAt(0).toUpperCase()+t.slice(1)}var e,s=["webkit","moz","ms","o"],n=document.createElement("div"),o=t.toLowerCase(),a=[];for(e=0;e<s.length;e+=1)a.push(s[e]+i(t));for(e=0;e<a.length;e+=1)if(void 0!==n.style[a[e]]){o="-"+s[e]+"-"+t;break}return o}function i(t){if(!t.length)return void 0;t=t.trim();return"true"===t.toLowerCase()?!0:"false"===t.toLowerCase()?!1:"null"===t.toLowerCase()?null:"undefined"===t.toLowerCase()?void 0:isNaN(t)?t:1!==t.indexOf(".")?parseFloat(t):parseInt(t,10)}function e(t){var e,s,n,o,a,r={};if(!t||!t.length)return r;e=t.split(";");for(s=0,n=e.length;n>s;s+=1){o=e[s].split(":");a=o[0].trim();a.length&&(r[a]=i(o[1]))}return r}function s(t,i){var e;for(e in i)i.hasOwnProperty(e)&&(t[e]=i[e]);return t}function n(t,i,e){this._isDown=!1;this._chancelId=!1;this._tracks={};this._tmpEvent={};this._trackEvents=this.isTouched?this.TRACK_TOUCH_EVENTS:this.TRACK_EVENTS;this.attach(t);this._listener=i;this.notify="object"==typeof i?function(t){this._listener.handleEvent(t)}:"object"==typeof e?function(t){this._listener.apply(e,[t])}:function(t){this._listener(t)}}function o(t,i){i=s({className:"scrollbar",direction:"vertical"},i);this.direction=i.direction;this._container=t;this._bar=document.createElement("div");this._bar.style.position="absolute";this._bar.className=i.className;this._bar.style.opacity=0;this._container.appendChild(this._bar);this._containerSize=0;this._position=0;this._max=0;this._translateArray="vertical"===this.direction?["translate3d(0, ",0,"px, 0)"]:["translate3d(",0,"px, 0, 0)"]}function a(t,i){var e,n,o,a=this;this._options=s({preventMove:!0,resizeEvent:!0,scroll:!0,bounds:!1,direction:"vertical",marginMIN:0,marginMAX:0,onScroll:function(t){console.dir(t)},onScrollBefore:function(t){console.dir(t);return!0},onScrollAfter:function(){},onScrollTypeChange:function(t){}},i);if("vertical"===this._options.direction){this._transitionArray=["translate3d(0, ",0,"px, 0)"];this._coordName="screenY";this._speedName="speedY"}else{this._transitionArray=["translate3d(",0,"px, 0, 0)"];this._coordName="screenX";this._speedName="speedX"}this._animParams=null;this._RafID=null;this._lastPointerPosition=0;this._shift=0;this._motionType=this._lastMotionType=this._STRINGS.stop;this._isMoved=!1;this._tmp={shift:0,now:0,easing:0,velocity:0};this._pos=0;this._root=t;this._wrapper=t.firstElementChild;e=["fixed","relative","absolute"];n=e.indexOf(window.getComputedStyle(t,null).position);-1===n&&(n=e.indexOf(t.style.position));this._root.style.position=-1===n?"relative":e[n];this._root.style.overflow="hidden";this._wrapper.style.margin=0;this._wrapper.style.position="absolute";this._wrapper.style[this._transitionName]="transform 0ms";for(o in this.TRACKING_EVENTS)this.TRACKING_EVENTS.hasOwnProperty(o)&&this._root.addEventListener(this.TRACKING_EVENTS[o],this,!1);this._options.resizeEvent&&window.addEventListener(this.TRACKING_EVENTS.resize,this,!1);this._animationStep=function(t){if(a._options.scroll){a._calculateShift(t);a._pos-=a._shift;if(a._motionType!==a._STRINGS.tweak||a._motionType!==a._STRINGS.stop){if(a._pos<a._min-a._margine){a._pos=a._min-a._margine;a._motionType=a._STRINGS.checkTweak}if(a._pos>a._margine+a._max){a._pos=a._margine+a._max;a._motionType=a._STRINGS.checkTweak}}if(0!==a._shift)if(a._isMoved||a._options.onScrollBefore(a._shift)){a._isMoved=!0;a._options.onScroll(a._shift,a._pos);if(a._lastMotionType!==a._motionType&&a._motionType!==a._STRINGS.checkTweak&&a._motionType!==a._STRINGS.stop){a._options.onScrollTypeChange(a._motionType);a._lastMotionType=a._motionType}}else a._motionType=a._STRINGS.stop;a._transitionArray[1]=a._pos;if(a._motionType===a._STRINGS.stop){a._transitionArray[1]=Math.round(a._transitionArray[1]);a._isMoved&&a._options.onScrollAfter();a._isMoved=!1}else a._RafID=window.requestAnimationFrame(a._animationStep);a._wrapper.style[a._transformName]=a._transitionArray.join("");a._shift=0}};this.refresh()}!function(t){t.Date.now||(t.Date.now=function(){return+new Date})}(window);!function(t){t.performance||(t.performance={});t.performance.now&&(t.performance.now=performance.webkitNow||performance.mozNow||performance.msNow||performance.oNow||function(){return Date.now()})}(window);!function(t){for(var i=0,e=["webkit","moz","ms","o"],s=0;s<e.length&&!t.requestAnimationFrame;++s){t.requestAnimationFrame=t[e[s]+"RequestAnimationFrame"];t.cancelAnimationFrame=t[e[s]+"CancelAnimationFrame"]||t[e[s]+"CancelRequestAnimationFrame"]}t.requestAnimationFrame||(t.requestAnimationFrame=function(e){var s=Date.now(),n=Math.max(0,16-(s-i)),o=t.setTimeout(function(){e(s+n)},n);i=s+n;return o});t.cancelAnimationFrame||(t.cancelAnimationFrame=function(t){clearTimeout(t)})}(window);n.prototype={TRACK_TOUCH_EVENTS:{touchstart:"touchstart",touchmove:"touchmove",touchend:"touchend",touchleave:"touchleave",touchcancel:".touchcancel"},TRACK_EVENTS:{mousedown:"mousedown",mousemove:"mousemove",mouseup:"mouseup",mouseover:"mouseover",mouseout:"mouseout"},FIRE_EVENTS:{up:"pointerup",down:"pointerdown",move:"pointermove",over:"pointerover",chancel:"pointercancel",fling:"fling",longtap:"longtap",tap:"tap"},isTouched:!window.device.desktop(),attach:function(t,i){var e,s=this.detach();this._catch=!!i;if(t){this._el=t;for(e in this._trackEvents)this._trackEvents.hasOwnProperty(e)&&this._el.addEventListener(this._trackEvents[e],this,!1)}return s},detach:function(){var t,i=this._el;if(i)for(t in this._trackEvents)this._trackEvents.hasOwnProperty(t)&&this._el.removeEventListener(this._trackEvents[t],this);this._el=null},destroy:function(){this.detach();this._listener=null;this._tmpEvent=null},handleEvent:function(t){null!==this._chancelId&&clearTimeout(this._chancelId);if(this._catch){switch(t.type){case this.TRACK_TOUCH_EVENTS.touchstart:case this.TRACK_EVENTS.mousedown:break;default:this._isDown=!0;this._chancelId=!1;this._pointerDown(t)}this._catch=!1}switch(t.type){case this.TRACK_TOUCH_EVENTS.touchmove:case this.TRACK_EVENTS.mousemove:this._isDown&&this._fireEvent(this.FIRE_EVENTS.move,t);break;case this.TRACK_TOUCH_EVENTS.touchstart:case this.TRACK_EVENTS.mousedown:this._isDown=!0;this._chancelId=!1;this._fireEvent(this.FIRE_EVENTS.down,t);break;case this.TRACK_TOUCH_EVENTS.touchend:case this.TRACK_TOUCH_EVENTS.touchleave:case this.TRACK_TOUCH_EVENTS.touchcancel:case this.TRACK_EVENTS.mouseup:if(this._isDown){this._isDown=!1;this._fireEvent(this.FIRE_EVENTS.up,t)}break;case this.TRACK_EVENTS.mouseover:this._isDown&&this._fireEvent(this.FIRE_EVENTS.over,t);break;case this.TRACK_EVENTS.mouseout:var i=this;this._isDown&&(this._chancelId=setTimeout(function(){i._isDown=!1;i._fireEvent(i.FIRE_EVENTS.chancel,t);i._chancelId=null},10))}},_pointerDown:function(t){this._tracks={start:{clientX:t.clientX,clientY:t.clientY,timeStamp:t.timeStamp},pre:{clientX:t.clientX,clientY:t.clientY,timeStamp:t.timeStamp},last:{clientX:t.clientX,clientY:t.clientY,timeStamp:t.timeStamp},end:{clientX:t.clientX,clientY:t.clientY,timeStamp:t.timeStamp}}},_pointerMove:function(t){if(t.timeStamp-this._tracks.last.timeStamp>10){this._tracks.pre.clientX=this._tracks.last.clientX;this._tracks.pre.clientY=this._tracks.last.clientY;this._tracks.pre.timeStamp=this._tracks.last.timeStamp;this._tracks.last.clientX=t.clientX;this._tracks.last.clientY=t.clientY;this._tracks.last.timeStamp=t.timeStamp}},_pointerUp:function(t){function i(t,i,e,s){return Math.pow((i-t)*(i-t)+(s-e)*(s-e),.5)}var e,s,n=this._tracks;this._tracks.end.clientX=t.clientX;this._tracks.end.clientY=t.clientY;this._tracks.end.timeStamp=t.timeStamp;e=Math.abs(i(n.start.clientX,n.end.clientX,n.start.clientY,n.end.clientY))>10;s=Math.abs(i(n.end.clientX,n.pre.clientX,n.end.clientY,n.pre.clientY))>0;if(s){this._tmpEvent.type=this.FIRE_EVENTS.fling;this._tmpEvent.start=n.start;this._tmpEvent.end=n.end;this._tmpEvent.speedX=(n.end.clientX-n.pre.clientX)/(n.end.timeStamp-n.pre.timeStamp);this._tmpEvent.speedY=(n.end.clientY-n.pre.clientY)/(n.end.timeStamp-n.pre.timeStamp);this.notify(this._tmpEvent)}else if(!e)if(n.end.timeStamp-n.start.timeStamp>300){this._tmpEvent.type=this.FIRE_EVENTS.longtap;this.notify(this._tmpEvent)}else{this._tmpEvent.type=this.FIRE_EVENTS.tap;this.notify(this._tmpEvent)}this._tracks=null},_fireEvent:function(t,i){var e,s,n=i;if(this.isTouched)if(i.type===this.TRACK_TOUCH_EVENTS.touchstart){if(i.touches.length>1)return;n=i.touches[0];this.touchID=i.touches[0].identifier}else{this.touchID||(this.touchID=i.changedTouches[0].identifier);for(e=0,s=i.changedTouches.length;s>e;e+=1){n=i.changedTouches[e];if(n.identifier===this.touchID)break}if(n.identifier!==this.touchID)return}else this.touchID=1;this._tmpEvent.type=t;this._tmpEvent.start=null;this._tmpEvent.end=null;this._tmpEvent.speedX=null;this._tmpEvent.speedY=null;this._tmpEvent.screenX=n.screenX;this._tmpEvent.screenY=n.screenY;this._tmpEvent.clientX=n.clientX;this._tmpEvent.clientY=n.clientY;this._tmpEvent.pointerType=this.isTouched?"touch":"mouse";this._tmpEvent.target=i.target;this._tmpEvent.currentTarget=i.currentTarget;this._tmpEvent.timeStamp=i.timeStamp;this._tmpEvent.preventDefault=function(){void 0!==i.preventDefault&&i.preventDefault()};this._tmpEvent.stopPropagation=function(){void 0!==i.stopPropagation&&i.stopPropagation()};this.notify(this._tmpEvent);switch(t){case this.FIRE_EVENTS.down:this._pointerDown(this._tmpEvent);break;case this.FIRE_EVENTS.move:this._pointerMove(this._tmpEvent);break;case this.FIRE_EVENTS.chancel:case this.FIRE_EVENTS.up:this._pointerUp(this._tmpEvent)}}};o.prototype={_transformName:t("transform"),_transitionName:t("transition"),setPosition:function(t){this._position=t;this._translateArray[1]=-t*this._containerSize/this._max;this._translateArray[1]<=0?this._translateArray[1]=0:this._translateArray[1]>=this._containerSize&&(this._translateArray[1]=this._containerSize);this._bar.style[this._transformName]=this._translateArray.join("")},refresh:function(t){var i=this;this._max=t;this._bar.style.opacity=0===Math.max(0,t)?0:1;if("vertical"===this.direction){this._bar.style.height=this._container.offsetHeight*(this._container.offsetHeight/(t+this._container.offsetHeight))+"px";this._containerSize=this._container.offsetHeight-this._bar.offsetHeight}else{this._bar.style.width=this._container.offsetWidth*(this._container.offsetWidth/(t+this._container.offsetWidth))+"px";this._containerSize=this._container.offsetWidth-this._bar.offsetWidth}this._bar.style[this._transitionName]="transform 300ms";this.setPosition(this._position);setTimeout(function(){i._bar.style[i._transitionName]="transform 0ms"},350)}};a.prototype={TRACKING_EVENTS:{resize:"resize",up:"pointerup",move:"pointermove",down:"pointerdown",chancel:"pointercancel",fling:"fling"},_STRINGS:{tweak:"tweak",checkTweak:"checkTweak",stop:"stop",scroll:"scroll",fling:"fling",move:"move"},_transitionName:t("transition"),_transformName:t("transform"),_calculateShift:function(t){if(null===this._animParams.startTime){this._animParams.startTime=t;this._animParams.lastTime=t}switch(this._motionType){case this._STRINGS.move:this._shift/=this._pos<this._min||this._pos>this._max?3:1;break;case this._STRINGS.fling:this._shift=this._animParams.velocity*(t-this._animParams.lastTime);this._tmp.velocity=this._animParams.velocity+this._animParams.a*(t-this._animParams.startTime);if(this._tmp.velocity/this._animParams.velocity>0){this._animParams.velocity=this._tmp.velocity;if(this._pos<this._min&&this._animParams.velocity>0||this._pos>this._max&&this._animParams.velocity<0){this._animParams.velocity+=.6*-this._animParams.velocity;Math.abs(this._shift)<.1&&(this._motionType=this._STRINGS.checkTweak)}}else this._motionType=this._STRINGS.checkTweak;break;case this._STRINGS.tweak:case this._STRINGS.scroll:this._tmp.now=Math.ceil(1e3*(t-this._animParams.startTime)/this._animParams.duration)/1e3;this._tmp.easing=this.easeFunc(this._tmp.now);this._tmp.shift=Math.ceil(1e3*this._animParams.shift*this._tmp.easing)/1e3;if(0!==this._animParams.duration)this._shift=this._tmp.shift-this._animParams.lastShift;else{this._shift=this._animParams.shift;this._tmp.now=1}if(this._tmp.now>=1)if(this._motionType===this._STRINGS.tweak){this._shift=this._animParams.shift-this._animParams.lastShift;this._motionType=this._STRINGS.stop}else this._motionType=this._STRINGS.checkTweak;this._animParams.lastShift=this._tmp.shift;break;case this._STRINGS.checkTweak:this._tmp.shift=this._pos>this._max?this._max-this._pos:this._pos<this._min?this._min-this._pos:0;if(this._options.tweak&&0===this._tmp.shift&&this._pos<this._max&&this._pos>this._min){this._tmp.shift=this._pos-Math.ceil(1e3*Math.round(this._pos/this._options.tweak)*this._options.tweak)/1e3;this._tmp.shift=-this._tmp.shift}this._animParams={shift:-this._tmp.shift,lastShift:0,duration:250,startTime:t,lastTime:null};this._motionType=0!==this._tmp.shift?this._STRINGS.tweak:this._STRINGS.stop}this._animParams.lastTime=t;this._shift=isNaN(this._shift)?0:this._shift},_eventPointerDown:function(t){window.cancelAnimationFrame(this._RafID);this._lastPointerPosition=t[this._coordName];this._animParams={};this._motionType=this._STRINGS.move;this._RafID=window.requestAnimationFrame(this._animationStep)},_eventPointerMove:function(t){this._shift+=this._lastPointerPosition-t[this._coordName];this._lastPointerPosition=t[this._coordName]},_eventPointerUp:function(t){this._motionType!==this._STRINGS.fling&&(this._motionType=this._STRINGS.checkTweak);this._eventPointerMove(t)},_eventFling:function(t){var i=this._options.scroll?-t[this._speedName]:0;if(0!==i){this._animParams={velocity:i,a:9e-5*-(0>i?-1:1),startTime:null,lastTime:null};this._motionType=this._STRINGS.fling}},preventDefaultTags:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/,easeFunc:function(t){return t*(2-t)},destroy:function(){var t;for(t in this.TRACKING_EVENTS)this.TRACKING_EVENTS.hasOwnProperty(t)&&this._root.removeEventListener(this.TRACKING_EVENTS[t],this);window.removeEventListener(this.TRACKING_EVENTS.resize,this);window.cancelAnimationFrame(this._RafID);this._root=null;this._wrapper=null;this._options=null},refresh:function(){var t=this._root.offsetWidth,i=this._root.offsetHeight;window.cancelAnimationFrame(this._RafID);this._motionType=this._STRINGS.stop;if("vertical"===this._options.direction){this._min=i<=this._wrapper.clientHeight?i-this._wrapper.clientHeight-this._options.marginMAX:0;this._margine=this._options.bounds?Math.round(i/3):0}else{this._min=t<=this._wrapper.offsetWidth?t-this._wrapper.clientWidth-this._options.marginMAX:0;this._margine=this._options.bounds?Math.round(t/3):0}this._max=this._options.marginMIN;this._motionType=this._STRINGS.checkTweak;this._animParams={};this._RafID=window.requestAnimationFrame(this._animationStep)},scroll:function(t,i){var e,s,n=i;window.cancelAnimationFrame(this._RafID);this._motionType=this._STRINGS.stop;if(0!==t){s=this._pos+t;if(s<this._min){e=this._min-this._pos;n=Math.abs(Math.round(i*e/t));t=e}if(s>this._max){e=this._max-this._pos;n=Math.abs(Math.round(i*e/t));t=e}}t=this._options.scroll?t:0;this._motionType=this._STRINGS.scroll;this._animParams={shift:-t,lastShift:0,duration:n,startTime:null,lastTime:null};this._RafID=window.requestAnimationFrame(this._animationStep)},handleEvent:function(t){var i=this;switch(t.type){case this.TRACKING_EVENTS.down:this._eventPointerDown(t);break;case this.TRACKING_EVENTS.move:this._eventPointerMove(t);this._options.preventMove&&!this.preventDefaultTags.test(t.target)&&t.preventDefault();break;case this.TRACKING_EVENTS.chancel:case this.TRACKING_EVENTS.up:this._eventPointerUp(t);break;case this.TRACKING_EVENTS.fling:this._eventFling(t);break;case this.TRACKING_EVENTS.resize:clearTimeout(this._resizeID);this._resizeID=setTimeout(function(){i.refresh()},150)}}};a.ScrollBar=o;a.PointerWrapper=n;!function(){var t;t=Object.create(HTMLDivElement.prototype);t.createdCallback=function(){var t,i=this,o=e(this.getAttribute("options"));if(!this.isInited&&this.parentNode){this.isInited=!0;o.scrollbar&&(this.scrollBar=new a.ScrollBar(this,{className:o.scrollbar,direction:o.direction||"vertical"}));o=s({onScrollBefore:function(){var t=!0;"function"==typeof i.onScrollBefore&&(t=i.onScrollBefore(arguments));return t},onScrollAfter:function(){"function"==typeof i.onScrollAfter&&i.onScrollAfter(arguments)},onScroll:function(){i.scrollBar&&i.scrollBar.setPosition(arguments[1]);"function"==typeof i.onScroll&&i.onScroll(arguments)}},o);this.scroller=new a(this,o);this.tracker=new n(this,this.scroller);t=this.scroller.refresh;this.scroller.refresh=function(){t.apply(i.scroller,arguments);i&&i.scrollBar&&i.scrollBar.refresh(-i.scroller._min)};this.refresh=function(){this.scroller.refresh()};this.scroll=function(t,i){this.scroller.scroll(t,i)};this.destroy=function(){this.scroller.destroy();this.tracker.destroy()}}};t.attachedCallback=function(){this.refresh()};t.detachedCallback=function(){};t.attributeChangedCallback=function(t,i,e){};return document.registerElement("x-scrollviewjs",{"extends":"div",prototype:t})}();return a});
